import{v as Z,_ as N,d as V,ab as w,a_ as q,o as A,k as M,l as e,w as t,cN as I,m as d,s as _,n as o,q as c,a8 as D,x as B,aH as E,c8 as L,c9 as W,cO as Y,e as T,bE as z,cm as ee,M as te,a6 as oe,aX as ne,F as ae,a7 as re}from"./index.ca2546a6.js";import{I as C}from"./InputCopyable.7bc43bc6.js";import{u as se}from"./validation.b283a4a1.js";import{a as le}from"./computedRefreshable.0826f861.js";import{c as k}from"./index.53b192e1.js";import{c as pe}from"./token-generator.service.136f9e9d.js";import{u as ie}from"./useQRCode.be7febed.js";import{_ as F}from"./InputGroup.fd1b42f8.js";import{_ as ce}from"./Progress.dbd336b0.js";import{R as ue}from"./Refresh.cc71d5d2.js";import{_ as _e}from"./Image.936751ef.js";import{_ as de}from"./FormItem.7d600ca2.js";import{_ as me}from"./InputGroupLabel.dedb67e3.js";import"./random.dbd16d9f.js";function fe(a){var n;return((n=a.match(/.{1,2}/g))!=null?n:[]).map(l=>parseInt(l,16))}function ge(a,n){return k.exports.HmacSHA1(k.exports.enc.Hex.parse(a),k.exports.enc.Hex.parse(G(n))).toString(k.exports.enc.Hex)}function G(a){var p;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";return((p=a.toUpperCase().replace(/=+$/,"").split("").map(r=>n.indexOf(r).toString(2).padStart(5,"0")).join("").match(/.{1,8}/g))!=null?p:[]).map(r=>parseInt(r,2).toString(16).padStart(2,"0")).join("")}function ve({key:a,counter:n=0}){const l=ge(n.toString(16).padStart(16,"0"),a),s=fe(l),p=s[19]&15,r=(s[p]&127)<<24|(s[p+1]&255)<<16|(s[p+2]&255)<<8|s[p+3]&255;return String(r%1e6).padStart(6,"0")}function P({now:a,timeStep:n}){return Math.floor(a/1e3/n)}function $({key:a,now:n=Date.now(),timeStep:l=30}){const s=P({now:n,timeStep:l});return ve({key:a,counter:s})}function he({secret:a,app:n="IT-Tools",account:l="demo-user",algorithm:s="SHA1",digits:p=6,period:r=30}){const v=Z({issuer:n,secret:a,algorithm:s,digits:p,period:r}).map((i,x)=>`${encodeURIComponent(x)}=${encodeURIComponent(i)}`).join("&");return`otpauth://totp/${encodeURIComponent(n)}:${encodeURIComponent(l)}?${v}`}function U(){return pe({length:16,alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"})}const H=a=>(L("data-v-4da3935e"),a=a(),W(),a),ye=H(()=>c("div",{style:{"text-align":"left"}},"Previous",-1)),xe=H(()=>c("div",{style:{"text-align":"center"}},"Current OTP",-1)),Se=H(()=>c("div",{style:{"text-align":"right"}},"Next",-1)),be=V({__name:"token-display",props:{tokens:null},setup(a){const n=a,{copy:l,copied:s}=w(),{copy:p,copied:r}=w(),{copy:g,copied:v}=w(),{tokens:i}=q(n);return(x,u)=>{const m=D,f=B,h=E,S=F;return A(),M("div",null,[e(m,{class:"labels","item-style":"flex: 1 1 0","w-full":"",align:"center"},{default:t(()=>[ye,xe,Se]),_:1}),e(S,null,{default:t(()=>[e(h,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(f,{"important:h-12":"","data-test-id":"previous-otp",onClick:u[0]||(u[0]=I(b=>o(l)(o(i).previous),["prevent"]))},{default:t(()=>[d(_(o(i).previous),1)]),_:1})]),default:t(()=>[c("div",null,_(o(s)?"Copied !":"Copy previous OTP"),1)]),_:1}),e(h,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(f,{"data-test-id":"current-otp",class:"current-otp","important:h-12":"",onClick:u[1]||(u[1]=I(b=>o(p)(o(i).current),["prevent"]))},{default:t(()=>[d(_(o(i).current),1)]),_:1})]),default:t(()=>[c("div",null,_(o(r)?"Copied !":"Copy current OTP"),1)]),_:1}),e(h,{trigger:"hover",placement:"bottom"},{trigger:t(()=>[e(f,{"important:h-12":"","data-test-id":"next-otp",onClick:u[2]||(u[2]=I(b=>o(g)(o(i).next),["prevent"]))},{default:t(()=>[d(_(o(i).next),1)]),_:1})]),default:t(()=>[c("div",null,_(o(v)?"Copied !":"Copy next OTP"),1)]),_:1})]),_:1})])}}});var Ce=N(be,[["__scopeId","data-v-4da3935e"]]);const ke={style:{"max-width":"350px"}},we={style:{"text-align":"center"}},Ie={style:{"max-width":"350px"}},Te=V({__name:"otp-code-generator-and-validator",setup(a){const n=Y(),l=T(()=>n.value/1e3%30),s=z(),p=ee(),r=te(U());function g(){r.value=U()}const[v]=le(()=>({previous:$({key:r.value,now:n.value-3e4}),current:$({key:r.value,now:n.value}),next:$({key:r.value,now:n.value+3e4})}),{throttle:500}),i=T(()=>he({secret:r.value})),{qrcode:x}=ie({text:i,color:{background:T(()=>p.isDarkTheme?"#ffffff":"#00000000"),foreground:"#000000"},options:{width:210}}),{attrs:u}=se({source:r,rules:[{message:"Secret should be a base32 string",validator:m=>m.toUpperCase().match(/^[A-Z234567]+$/)},{message:"Please set a secret",validator:m=>m!==""}]});return(m,f)=>{const h=oe,S=B,b=E,j=re,y=de,K=ce,J=_e,Q=D,O=me,R=F;return A(),M(ae,null,[c("div",ke,[e(y,ne({label:"Secret"},o(u)),{default:t(()=>[e(j,{value:r.value,"onUpdate:value":f[0]||(f[0]=X=>r.value=X),placeholder:"Paste your TOTP secret..."},{suffix:t(()=>[e(b,{trigger:"hover"},{trigger:t(()=>[e(S,{circle:"",variant:"text",onClick:g},{default:t(()=>[e(h,{component:o(ue)},null,8,["component"])]),_:1})]),default:t(()=>[d(" Generate secret token ")]),_:1})]),_:1},8,["value"])]),_:1},16),c("div",null,[e(Ce,{tokens:o(v),style:{"margin-top":"2px"}},null,8,["tokens"]),e(K,{percentage:100*o(l)/30,color:o(s).primaryColor,"show-indicator":!1},null,8,["percentage","color"]),c("div",we,"Next in "+_(String(Math.floor(30-o(l))).padStart(2,"0"))+"s",1)]),e(Q,{justify:"center",vertical:"",align:"center",style:{"margin-top":"10px"}},{default:t(()=>[e(J,{src:o(x)},null,8,["src"]),e(S,{href:o(i),target:"_blank"},{default:t(()=>[d("Open Key URI in new tab")]),_:1},8,["href"])]),_:1})]),c("div",Ie,[e(y,{label:"Secret in hexadecimal"},{default:t(()=>[e(C,{value:o(G)(r.value),readonly:"",placeholder:"Secret in hex will be displayed here"},null,8,["value"])]),_:1}),e(y,{label:"Epoch"},{default:t(()=>[e(C,{value:Math.floor(o(n)/1e3).toString(),readonly:"",placeholder:"Epoch in sec will be displayed here"},null,8,["value"])]),_:1}),e(y,{label:"Iteration","show-feedback":!1},{default:t(()=>[e(R,null,{default:t(()=>[e(O,{style:{width:"110px"}},{default:t(()=>[d("Count:")]),_:1}),e(C,{value:String(o(P)({now:o(n),timeStep:30})),readonly:"",placeholder:"Iteration count will be displayed here"},null,8,["value"])]),_:1})]),_:1}),e(y,{label:"Iteration","show-label":!1,style:{"margin-top":"5px"}},{default:t(()=>[e(R,null,{default:t(()=>[e(O,{style:{width:"110px"}},{default:t(()=>[d("Padded hex:")]),_:1}),e(C,{value:o(P)({now:o(n),timeStep:30}).toString(16).padStart(16,"0"),readonly:"",placeholder:"Iteration count in hex will be displayed here"},null,8,["value"])]),_:1})]),_:1})])],64)}}});var Ge=N(Te,[["__scopeId","data-v-7ae01191"]]);export{Ge as default};
