import{_ as Z}from"./c-input-text.1faff010.js";import{o as P,k as R,q as c,v as J,_ as H,d as O,aq as w,G as L,l as n,w as a,cR as k,m as h,s as _,n as o,an as V,y as M,aS as N,cc as B,cd as D,cS as Q,e as $,c5 as W,cq as X,A as Y,F as z}from"./index.2e6b7445.js";import{_ as b}from"./InputCopyable.eac6f423.js";import{a as ee}from"./computedRefreshable.1a2846ea.js";import{c as C}from"./index.d87f09eb.js";import{c as te}from"./token-generator.service.5b58c0d8.js";import{u as oe}from"./useQRCode.58f67845.js";import{_ as ne}from"./InputGroup.1caaa6ff.js";import{_ as re}from"./Progress.c618f555.js";import{_ as ae}from"./Image.579b4b00.js";import"./random.613c1dc4.js";import"./validation.89ce9e2c.js";import"./content-copy.43681fe1.js";const se={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},le=c("path",{fill:"currentColor",d:"M17.65 6.35A7.958 7.958 0 0 0 12 4a8 8 0 0 0-8 8a8 8 0 0 0 8 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18a6 6 0 0 1-6-6a6 6 0 0 1 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35Z"},null,-1),ie=[le];function ce(t,e){return P(),R("svg",se,ie)}var pe={name:"mdi-refresh",render:ce};function ue(t){var e;return((e=t.match(/.{1,2}/g))!=null?e:[]).map(l=>parseInt(l,16))}function _e(t,e){return C.exports.HmacSHA1(C.exports.enc.Hex.parse(t),C.exports.enc.Hex.parse(G(e))).toString(C.exports.enc.Hex)}function G(t){var i;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";return((i=t.toUpperCase().replace(/=+$/,"").split("").map(r=>e.indexOf(r).toString(2).padStart(5,"0")).join("").match(/.{1,8}/g))!=null?i:[]).map(r=>parseInt(r,2).toString(16).padStart(2,"0")).join("")}function de({key:t,counter:e=0}){const l=_e(e.toString(16).padStart(16,"0"),t),s=ue(l),i=s[19]&15,r=(s[i]&127)<<24|(s[i+1]&255)<<16|(s[i+2]&255)<<8|s[i+3]&255;return String(r%1e6).padStart(6,"0")}function I({now:t,timeStep:e}){return Math.floor(t/1e3/e)}function T({key:t,now:e=Date.now(),timeStep:l=30}){const s=I({now:e,timeStep:l});return de({key:t,counter:s})}function me({secret:t,app:e="IT-Tools",account:l="demo-user",algorithm:s="SHA1",digits:i=6,period:r=30}){const f=J({issuer:e,secret:t,algorithm:s,digits:i,period:r}).map((p,x)=>`${encodeURIComponent(x)}=${encodeURIComponent(p)}`).join("&");return`otpauth://totp/${encodeURIComponent(e)}:${encodeURIComponent(l)}?${f}`}function A(){return te({length:16,alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"})}const U=t=>(B("data-v-4da3935e"),t=t(),D(),t),ve=U(()=>c("div",{style:{"text-align":"left"}},"Previous",-1)),fe=U(()=>c("div",{style:{"text-align":"center"}},"Current OTP",-1)),ge=U(()=>c("div",{style:{"text-align":"right"}},"Next",-1)),he=O({__name:"token-display",props:{tokens:null},setup(t){const e=t,{copy:l,copied:s}=w(),{copy:i,copied:r}=w(),{copy:v,copied:f}=w(),{tokens:p}=L(e);return(x,u)=>{const d=V,m=M,g=N,y=ne;return P(),R("div",null,[n(d,{class:"labels","item-style":"flex: 1 1 0","w-full":"",align:"center"},{default:a(()=>[ve,fe,ge]),_:1}),n(y,null,{default:a(()=>[n(g,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(m,{"important:h-12":"","data-test-id":"previous-otp",onClick:u[0]||(u[0]=k(S=>o(l)(o(p).previous),["prevent"]))},{default:a(()=>[h(_(o(p).previous),1)]),_:1})]),default:a(()=>[c("div",null,_(o(s)?"Copied !":"Copy previous OTP"),1)]),_:1}),n(g,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(m,{"data-test-id":"current-otp",class:"current-otp","important:h-12":"",onClick:u[1]||(u[1]=k(S=>o(i)(o(p).current),["prevent"]))},{default:a(()=>[h(_(o(p).current),1)]),_:1})]),default:a(()=>[c("div",null,_(o(r)?"Copied !":"Copy current OTP"),1)]),_:1}),n(g,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(m,{"important:h-12":"","data-test-id":"next-otp",onClick:u[2]||(u[2]=k(S=>o(v)(o(p).next),["prevent"]))},{default:a(()=>[h(_(o(p).next),1)]),_:1})]),default:a(()=>[c("div",null,_(o(f)?"Copied !":"Copy next OTP"),1)]),_:1})]),_:1})])}}});var xe=H(he,[["__scopeId","data-v-4da3935e"]]);const ye=t=>(B("data-v-0c3ee0f7"),t=t(),D(),t),Se={style:{"max-width":"350px"}},be={style:{"text-align":"center"}},Ce={style:{"max-width":"350px"}},we=ye(()=>c("p",null,"Iteration",-1)),ke=O({__name:"otp-code-generator-and-validator",setup(t){const e=Q(),l=$(()=>e.value/1e3%30),s=W(),i=X(),r=Y(A());function v(){r.value=A()}const[f]=ee(()=>({previous:T({key:r.value,now:e.value-3e4}),current:T({key:r.value,now:e.value}),next:T({key:r.value,now:e.value+3e4})}),{throttle:500}),p=$(()=>me({secret:r.value})),{qrcode:x}=oe({text:p,color:{background:$(()=>i.isDarkTheme?"#ffffff":"#00000000"),foreground:"#000000"},options:{width:210}}),u=[{message:"Secret should be a base32 string",validator:d=>d.toUpperCase().match(/^[A-Z234567]+$/)},{message:"Please set a secret",validator:d=>d!==""}];return(d,m)=>{const g=pe,y=M,S=N,E=Z,F=re,j=ae,q=V;return P(),R(z,null,[c("div",Se,[n(E,{value:r.value,"onUpdate:value":m[0]||(m[0]=K=>r.value=K),label:"Secret",placeholder:"Paste your TOTP secret...","mb-5":"","validation-rules":u},{suffix:a(()=>[n(S,{trigger:"hover"},{trigger:a(()=>[n(y,{circle:"",variant:"text",size:"small",onClick:v},{default:a(()=>[n(g)]),_:1})]),default:a(()=>[h(" Generate secret token ")]),_:1})]),_:1},8,["value"]),c("div",null,[n(xe,{tokens:o(f),style:{"margin-top":"2px"}},null,8,["tokens"]),n(F,{percentage:100*o(l)/30,color:o(s).primaryColor,"show-indicator":!1},null,8,["percentage","color"]),c("div",be,"Next in "+_(String(Math.floor(30-o(l))).padStart(2,"0"))+"s",1)]),n(q,{justify:"center",vertical:"",align:"center",style:{"margin-top":"10px"}},{default:a(()=>[n(j,{src:o(x)},null,8,["src"]),n(y,{href:o(p),target:"_blank"},{default:a(()=>[h("Open Key URI in new tab")]),_:1},8,["href"])]),_:1})]),c("div",Ce,[n(b,{label:"Secret in hexadecimal",value:o(G)(r.value),readonly:"",placeholder:"Secret in hex will be displayed here","mb-5":""},null,8,["value"]),n(b,{label:"Epoch",value:Math.floor(o(e)/1e3).toString(),readonly:"","mb-5":"",placeholder:"Epoch in sec will be displayed here"},null,8,["value"]),we,n(b,{value:String(o(I)({now:o(e),timeStep:30})),readonly:"",label:"Count:","label-position":"left","label-width":"90px","label-align":"right",placeholder:"Iteration count will be displayed here"},null,8,["value"]),n(b,{value:o(I)({now:o(e),timeStep:30}).toString(16).padStart(16,"0"),readonly:"",placeholder:"Iteration count in hex will be displayed here","label-position":"left","label-width":"90px","label-align":"right",label:"Padded hex:"},null,8,["value"])])],64)}}});var De=H(ke,[["__scopeId","data-v-0c3ee0f7"]]);export{De as default};
