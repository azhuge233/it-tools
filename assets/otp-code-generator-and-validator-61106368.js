import{o as I,j as P,q as c,v as j,d as R,aH as C,ac as K,k as n,w as a,a9 as U,aa as O,cF as w,m as g,s as _,n as e,x as A,aX as V,p as B,cG as Z,e as k,bS as J,cf as L,z as Q,B as X,F as q,C as z}from"./index-daf2c61e.js";import{u as W}from"./useQRCode-7127933e.js";import{c as y}from"./index-a30dda74.js";import{c as Y}from"./token-generator.service-fabc9c51.js";import{_ as ee}from"./InputGroup-d18f8553.js";import{_ as b}from"./InputCopyable.vue_vue_type_script_setup_true_lang-0a04347a.js";import{a as te}from"./computedRefreshable-68f4aa5d.js";import{_ as oe}from"./Progress-36fde349.js";import{_ as ne}from"./Image-23670652.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./___vite-browser-external_commonjs-proxy-65b40d99.js";import"./content-copy-ae1cb2d2.js";import"./use-locale-44154ab2.js";const re={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ae=c("path",{fill:"currentColor",d:"M17.65 6.35A7.958 7.958 0 0 0 12 4a8 8 0 0 0-8 8a8 8 0 0 0 8 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18a6 6 0 0 1-6-6a6 6 0 0 1 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35Z"},null,-1),se=[ae];function le(t,o){return I(),P("svg",re,se)}const ce={name:"mdi-refresh",render:le};function ie(t){return(t.match(/.{1,2}/g)??[]).map(o=>parseInt(o,16))}function pe(t,o){return y.HmacSHA1(y.enc.Hex.parse(t),y.enc.Hex.parse(M(o))).toString(y.enc.Hex)}function M(t){const o="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";return(t.toUpperCase().replace(/=+$/,"").split("").map(l=>o.indexOf(l).toString(2).padStart(5,"0")).join("").match(/.{1,8}/g)??[]).map(l=>parseInt(l,2).toString(16).padStart(2,"0")).join("")}function ue({key:t,counter:o=0}){const i=pe(o.toString(16).padStart(16,"0"),t),s=ie(i),l=s[19]&15,r=(s[l]&127)<<24|(s[l+1]&255)<<16|(s[l+2]&255)<<8|s[l+3]&255;return String(r%1e6).padStart(6,"0")}function $({now:t,timeStep:o}){return Math.floor(t/1e3/o)}function T({key:t,now:o=Date.now(),timeStep:i=30}){const s=$({now:o,timeStep:i});return ue({key:t,counter:s})}function de({secret:t,app:o="IT-Tools",account:i="demo-user",algorithm:s="SHA1",digits:l=6,period:r=30}){const h=j({issuer:o,secret:t,algorithm:s,digits:l,period:r}).map((p,x)=>`${encodeURIComponent(x)}=${encodeURIComponent(p)}`).join("&");return`otpauth://totp/${encodeURIComponent(o)}:${encodeURIComponent(i)}?${h}`}function H(){return Y({length:16,alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"})}const _e=t=>(U("data-v-6fbac034"),t=t(),O(),t),me=_e(()=>c("div",{class:"labels","w-full":"",flex:"","items-center":""},[c("div",{"flex-1":"","text-left":""}," Previous "),c("div",{"flex-1":"","text-center":""}," Current OTP "),c("div",{"flex-1":"","text-right":""}," Next ")],-1)),fe=R({__name:"token-display",props:{tokens:{}},setup(t){const o=t,{copy:i,copied:s}=C(),{copy:l,copied:r}=C(),{copy:f,copied:h}=C(),{tokens:p}=K(o);return(x,u)=>{const d=A,m=V,S=ee;return I(),P("div",null,[me,n(S,null,{default:a(()=>[n(m,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(d,{"important:h-12":"","data-test-id":"previous-otp",onClick:u[0]||(u[0]=w(v=>e(i)(e(p).previous),["prevent"]))},{default:a(()=>[g(_(e(p).previous),1)]),_:1})]),default:a(()=>[c("div",null,_(e(s)?"Copied !":"Copy previous OTP"),1)]),_:1}),n(m,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(d,{"data-test-id":"current-otp",class:"current-otp","important:h-12":"",onClick:u[1]||(u[1]=w(v=>e(l)(e(p).current),["prevent"]))},{default:a(()=>[g(_(e(p).current),1)]),_:1})]),default:a(()=>[c("div",null,_(e(r)?"Copied !":"Copy current OTP"),1)]),_:1}),n(m,{trigger:"hover",placement:"bottom"},{trigger:a(()=>[n(d,{"important:h-12":"","data-test-id":"next-otp",onClick:u[2]||(u[2]=w(v=>e(f)(e(p).next),["prevent"]))},{default:a(()=>[g(_(e(p).next),1)]),_:1})]),default:a(()=>[c("div",null,_(e(h)?"Copied !":"Copy next OTP"),1)]),_:1})]),_:1})])}}});const he=B(fe,[["__scopeId","data-v-6fbac034"]]),ve=t=>(U("data-v-7c23c2c2"),t=t(),O(),t),ge={style:{"max-width":"350px"}},xe={style:{"text-align":"center"}},ye={"mt-4":"",flex:"","flex-col":"","items-center":"","justify-center":"","gap-3":""},be={style:{"max-width":"350px"}},Se=ve(()=>c("p",null,"Iteration",-1)),Ce=R({__name:"otp-code-generator-and-validator",setup(t){const o=Z(),i=k(()=>o.value/1e3%30),s=J(),l=L(),r=Q(H());function f(){r.value=H()}const[h]=te(()=>({previous:T({key:r.value,now:o.value-3e4}),current:T({key:r.value,now:o.value}),next:T({key:r.value,now:o.value+3e4})}),{throttle:500}),p=k(()=>de({secret:r.value})),{qrcode:x}=W({text:p,color:{background:k(()=>l.isDarkTheme?"#ffffff":"#00000000"),foreground:"#000000"},options:{width:210}}),u=[{message:"Secret should be a base32 string",validator:d=>d.toUpperCase().match(/^[A-Z234567]+$/)},{message:"Please set a secret",validator:d=>d!==""}];return(d,m)=>{const S=ce,v=A,N=V,D=z,E=oe,F=ne;return I(),P(q,null,[c("div",ge,[n(D,{value:e(r),"onUpdate:value":m[0]||(m[0]=G=>X(r)?r.value=G:null),label:"Secret",placeholder:"Paste your TOTP secret...","mb-5":"","validation-rules":u},{suffix:a(()=>[n(N,{trigger:"hover"},{trigger:a(()=>[n(v,{circle:"",variant:"text",size:"small",onClick:f},{default:a(()=>[n(S)]),_:1})]),default:a(()=>[g(" Generate secret token ")]),_:1})]),_:1},8,["value"]),c("div",null,[n(he,{tokens:e(h),style:{"margin-top":"2px"}},null,8,["tokens"]),n(E,{percentage:100*e(i)/30,color:e(s).primaryColor,"show-indicator":!1},null,8,["percentage","color"]),c("div",xe," Next in "+_(String(Math.floor(30-e(i))).padStart(2,"0"))+"s ",1)]),c("div",ye,[n(F,{src:e(x)},null,8,["src"]),n(v,{href:e(p),target:"_blank"},{default:a(()=>[g(" Open Key URI in new tab ")]),_:1},8,["href"])])]),c("div",be,[n(b,{label:"Secret in hexadecimal",value:e(M)(e(r)),readonly:"",placeholder:"Secret in hex will be displayed here","mb-5":""},null,8,["value"]),n(b,{label:"Epoch",value:Math.floor(e(o)/1e3).toString(),readonly:"","mb-5":"",placeholder:"Epoch in sec will be displayed here"},null,8,["value"]),Se,n(b,{value:String(e($)({now:e(o),timeStep:30})),readonly:"",label:"Count:","label-position":"left","label-width":"90px","label-align":"right",placeholder:"Iteration count will be displayed here"},null,8,["value"]),n(b,{value:e($)({now:e(o),timeStep:30}).toString(16).padStart(16,"0"),readonly:"",placeholder:"Iteration count in hex will be displayed here","label-position":"left","label-width":"90px","label-align":"right",label:"Padded hex:"},null,8,["value"])])],64)}}});const Me=B(Ce,[["__scopeId","data-v-7c23c2c2"]]);export{Me as default};
